# Sketch.rb

https://github.com/apple/swift-corelibs-foundation/blob/master/Foundation/NSCoder.swift

(Sketch ->
  (SQLite ->
    (bplist ->
      (NSDictionary)
    )
  )
)

## SQLite structure

- metadata(NSCoding)
  - commit
  - length
  - fonts
  - app
  - build
  - version
  - variant
- payload(binary plist)
  - main

### payload

- $version - int
- $objects - array
- $archiver - string(MSArchiver)
- $top - dict
  - root - int(1)

#### $objects

```ruby
{"$version"=>100000,
 "$objects"=>
  ["$null",
   {"assets"=>2,
    "currentPageIndex"=>0,
    "layerStyles"=>16,
    "pages"=>28,
    "$class"=>107,
    "enableSliceInteraction"=>true,
    "layerTextStyles"=>24,
    "enableLayerInteraction"=>true,
    "layerSymbols"=>20},
   {"gradients"=>7,
    "colors"=>3,
    "imageCollection"=>9,
    "images"=>13,
    "$class"=>15},
   {"array_do"=>4, "$class"=>6},
   {"$class"=>5},
   {"$classname"=>"NSMutableArray",
    "$classes"=>["NSMutableArray", "NSArray", "NSObject"]},
   {"$classname"=>"MSImmutableArray",
    "$classes"=>
     ["MSImmutableArray",
      "MSImmutableModelBase",
      "MSModelObject",
      "NSObject"]},
   {"array_do"=>8, "$class"=>6},
   {"$class"=>5},
   {"images"=>10, "$class"=>12},
   {"$class"=>11},
   {"$classname"=>"NSDictionary", "$classes"=>["NSDictionary", "NSObject"]},
   {"$classname"=>"MSImmutableImageCollection",
    "$classes"=>
     ["MSImmutableImageCollection",
      "_MSImmutableImageCollection",
      "MSImmutableModelBase",
      "MSModelObject",
      "NSObject"]},
   {"array_do"=>14, "$class"=>6},
   {"$class"=>5},
   {"$classname"=>"MSImmutableAssetCollection",
    "$classes"=>
     ["MSImmutableAssetCollection",
      "_MSImmutableAssetCollection",
      "MSImmutableModelBase",
      "MSModelObject",
      "NSObject"]},
   {"objects"=>17, "$class"=>19},
   {"array_do"=>18, "$class"=>6},
   {"$class"=>5},
   {"$classname"=>"MSImmutableSharedLayerStyleContainer",
    "$classes"=>
     ["MSImmutableSharedLayerStyleContainer",
      "_MSImmutableSharedLayerStyleContainer",
      "MSImmutableSharedObjectContainer",
      "_MSImmutableSharedObjectContainer",
      "MSImmutableModelBase",
      "MSModelObject",
      "NSObject"]},
   {"objects"=>21, "$class"=>23},
   {"array_do"=>22, "$class"=>6},
   {"$class"=>5},
   {"$classname"=>"MSImmutableSharedLayerContainer",
    "$classes"=>
     ["MSImmutableSharedLayerContainer",
      "_MSImmutableSharedLayerContainer",
      "MSImmutableSharedObjectContainer",
      "_MSImmutableSharedObjectContainer",
      "MSImmutableModelBase",
      "MSModelObject",
      "NSObject"]},
   {"objects"=>25, "$class"=>27},
   {"array_do"=>26, "$class"=>6},
   {"$class"=>5},
   {"$classname"=>"MSImmutableSharedLayerTextStyleContainer",
    "$classes"=>
     ["MSImmutableSharedLayerTextStyleContainer",
      "_MSImmutableSharedLayerTextStyleContainer",
      "MSImmutableSharedLayerStyleContainer",
      "_MSImmutableSharedLayerStyleContainer",
      "MSImmutableSharedObjectContainer",
      "_MSImmutableSharedObjectContainer",
      "MSImmutableModelBase",
      "MSModelObject",
      "NSObject"]},
   {"array_do"=>29, "$class"=>6},
   {"$class"=>5, "NS.object.0"=>30},
   {"originalObjectID"=>0,
    "isFlippedHorizontal"=>false,
    "style"=>40,
    "rotation"=>0.0,
    "frame"=>37,
    "hasClickThrough"=>true,
    "horizontalRulerData"=>98,
    "exportOptions"=>31,
    "layerListExpandedType"=>0,
    "zoomValue"=>1.0,
    "do_objectID"=>105,
    "$class"=>106,
    "verticalRulerData"=>102,
    "isFlippedVertical"=>false,
    "nameIsFixed"=>false,
    "name"=>39,
    "layers"=>42,
    "isVisible"=>true,
    "userInfo"=>0,
    "grid"=>0,
    "isLocked"=>false,
    "scrollOrigin"=>101,
    "layout"=>0,
    "shouldBreakMaskChain"=>false,
    "sharedObjectID"=>0},
   {"sizes"=>34,
    "includedLayerIds"=>32,
    "layerOptions"=>0,
    "$class"=>36,
    "shouldTrim"=>false},
   {"array_do"=>33, "$class"=>6},
   {"$class"=>5},
   {"array_do"=>35, "$class"=>6},
   {"$class"=>5},
   {"$classname"=>"MSImmutableExportOptions",
    "$classes"=>
     ["MSImmutableExportOptions",
      "_MSImmutableExportOptions",
      "MSImmutableModelBase",
      "MSModelObject",
      "NSObject"]},
   {"y"=>0.0,
    "$class"=>38,
    "constrainProportions"=>false,
    "width"=>300.0,
    "height"=>300.0,
    "x"=>0.0},
   {"$classname"=>"MSImmutableRect",
    "$classes"=>
     ["MSImmutableRect",
      "_MSImmutableRect",
      "MSImmutableModelBase",
      "MSModelObject",
      "NSObject"]},
   "Page 1",
   {"$class"=>41,
    "startDecorationType"=>0,
    "sharedObjectID"=>0,
    "miterLimit"=>10,
    "textStyle"=>0,
    "endDecorationType"=>0},
   {"$classname"=>"MSImmutableStyle",
    "$classes"=>
     ["MSImmutableStyle",
      "_MSImmutableStyle",
      "MSImmutableModelBase",
      "MSModelObject",
      "NSObject"]},
   {"array_do"=>43, "$class"=>6},
   {"$class"=>5, "NS.object.0"=>44},
   {"originalObjectID"=>0,
    "isFlippedHorizontal"=>false,
    "style"=>52,
    "rotation"=>0.0,
    "frame"=>50,
    "hasClickThrough"=>false,
    "layerListExpandedType"=>0,
    "exportOptions"=>45,
    "hasBackgroundColor"=>false,
    "horizontalRulerData"=>89,
    "do_objectID"=>96,
    "backgroundColor"=>87,
    "$class"=>97,
    "verticalRulerData"=>93,
    "isFlippedVertical"=>false,
    "nameIsFixed"=>false,
    "name"=>51,
    "layers"=>53,
    "isVisible"=>true,
    "userInfo"=>0,
    "grid"=>0,
    "isLocked"=>false,
    "layout"=>0,
    "shouldBreakMaskChain"=>false,
    "sharedObjectID"=>0,
    "includeBackgroundColorInExport"=>true},
   {"sizes"=>48,
    "includedLayerIds"=>46,
    "layerOptions"=>0,
    "$class"=>36,
    "shouldTrim"=>false},
   {"array_do"=>47, "$class"=>6},
   {"$class"=>5},
   {"array_do"=>49, "$class"=>6},
   {"$class"=>5},
   {"y"=>154.0,
    "$class"=>38,
    "constrainProportions"=>false,
    "width"=>256.0,
    "height"=>256.0,
    "x"=>312.0},
   "FirstArtboard",
   {"$class"=>41,
    "startDecorationType"=>0,
    "sharedObjectID"=>0,
    "miterLimit"=>10,
    "textStyle"=>0,
    "endDecorationType"=>0},
   {"array_do"=>54, "$class"=>6},
   {"$class"=>5, "NS.object.0"=>55},
   {"originalObjectID"=>0,
    "usesNewLineSpacingBehaviour"=>false,
    "style"=>64,
    "rotation"=>0.0,
    "frame"=>61,
    "isFlippedHorizontal"=>false,
    "storage"=>80,
    "exportOptions"=>56,
    "textBehaviour"=>0,
    "dontSynchroniseWithSymbol"=>false,
    "heightIsClipped"=>false,
    "layerListExpandedType"=>0,
    "do_objectID"=>85,
    "$class"=>86,
    "isFlippedVertical"=>false,
    "nameIsFixed"=>false,
    "name"=>63,
    "isVisible"=>true,
    "userInfo"=>0,
    "isLocked"=>false,
    "shouldBreakMaskChain"=>false,
    "automaticallyDrawOnUnderlyingPath"=>false},
   {"sizes"=>59,
    "includedLayerIds"=>57,
    "layerOptions"=>0,
    "$class"=>36,
    "shouldTrim"=>false},
   {"array_do"=>58, "$class"=>6},
   {"$class"=>5},
   {"array_do"=>60, "$class"=>6},
   {"$class"=>5},
   {"$class"=>38,
    "height"=>78.0,
    "do_objectID"=>62,
    "y"=>82.0,
    "constrainProportions"=>false,
    "width"=>203.0,
    "x"=>27.0},
   "71AA7BF7-737F-442A-BEEF-5098DE06191C",
   "abc123",
   {"$class"=>41,
    "startDecorationType"=>0,
    "sharedObjectID"=>0,
    "miterLimit"=>10,
    "textStyle"=>65,
    "endDecorationType"=>0},
   {"attributes"=>66, "$class"=>79},
   {"NS.object.2"=>76,
    "$class"=>11,
    "NS.key.2"=>75,
    "NS.key.1"=>72,
    "NS.object.1"=>73,
    "NS.key.0"=>67,
    "NS.object.0"=>68},
   "NSColor",
   {"NSRGB"=>"0.2604963861 0.2438145034 0.25934894\x00",
    "NSColorSpace"=>1,
    "NSCustomColorSpace"=>69,
    "$class"=>71},
   {"NSID"=>1, "$class"=>70},
   {"$classname"=>"NSColorSpace", "$classes"=>["NSColorSpace", "NSObject"]},
   {"$classname"=>"NSColor", "$classes"=>["NSColor", "NSObject"]},
   "NSParagraphStyle",
   {"NSTabStops"=>0, "$class"=>74, "NSAlignment"=>4},
   {"$classname"=>"NSParagraphStyle",
    "$classes"=>["NSParagraphStyle", "NSObject"]},
   "NSFont",
   {"NSSize"=>67.0, "NSfFlags"=>16, "NSName"=>77, "$class"=>78},
   "Colo-Pro",
   {"$classname"=>"NSFont", "$classes"=>["NSFont", "NSObject"]},
   {"$classname"=>"MSImmutableTextStyle",
    "$classes"=>
     ["MSImmutableTextStyle",
      "_MSImmutableTextStyle",
      "MSImmutableModelBase",
      "MSModelObject",
      "NSObject"]},
   {"NSString"=>81, "NSDelegate"=>0, "NSAttributes"=>83, "$class"=>84},
   {"$class"=>82, "NS.bytes"=>"abc123"},
   {"$classname"=>"NSMutableString",
    "$classes"=>["NSMutableString", "NSString", "NSObject"]},
   {"NS.object.2"=>76,
    "$class"=>11,
    "NS.key.2"=>75,
    "NS.key.1"=>72,
    "NS.object.1"=>73,
    "NS.key.0"=>67,
    "NS.object.0"=>68},
   {"$classname"=>"NSTextStorage",
    "$classes"=>
     ["NSTextStorage",
      "NSMutableAttributedString",
      "NSAttributedString",
      "NSObject"]},
   "F5AA1035-888F-4155-9160-ADADC1831924",
   {"$classname"=>"MSImmutableTextLayer",
    "$classes"=>
     ["MSImmutableTextLayer",
      "_MSImmutableTextLayer",
      "MSImmutableStyledLayer",
      "_MSImmutableStyledLayer",
      "MSImmutableLayer",
      "_MSImmutableLayer",
      "MSImmutableModelBase",
      "MSModelObject",
      "NSObject"]},
   {"$class"=>88, "red"=>1.0, "alpha"=>1.0, "blue"=>1.0, "green"=>1.0},
   {"$classname"=>"MSImmutableColor",
    "$classes"=>
     ["MSImmutableColor",
      "_MSImmutableColor",
      "MSImmutableModelBase",
      "MSModelObject",
      "NSObject"]},
   {"base"=>0, "guides"=>90, "$class"=>92},
   {"array_do"=>91, "$class"=>6},
   {"$class"=>5},
   {"$classname"=>"MSImmutableRulerData",
    "$classes"=>
     ["MSImmutableRulerData",
      "_MSImmutableRulerData",
      "MSImmutableModelBase",
      "MSModelObject",
      "NSObject"]},
   {"base"=>0, "guides"=>94, "$class"=>92},
   {"array_do"=>95, "$class"=>6},
   {"$class"=>5},
   "F6BCFE76-C56E-4622-B099-FBEEFB1C6B8F",
   {"$classname"=>"MSImmutableArtboardGroup",
    "$classes"=>
     ["MSImmutableArtboardGroup",
      "_MSImmutableArtboardGroup",
      "MSImmutableLayerGroup",
      "_MSImmutableLayerGroup",
      "MSImmutableStyledLayer",
      "_MSImmutableStyledLayer",
      "MSImmutableLayer",
      "_MSImmutableLayer",
      "MSImmutableModelBase",
      "MSModelObject",
      "NSObject"]},
   {"base"=>0, "guides"=>99, "$class"=>92},
   {"array_do"=>100, "$class"=>6},
   {"$class"=>5},
   "{54, 54}",
   {"base"=>0, "guides"=>103, "$class"=>92},
   {"array_do"=>104, "$class"=>6},
   {"$class"=>5},
   "266DEB24-D89C-4FB8-977F-3AA53638212E",
   {"$classname"=>"MSImmutablePage",
    "$classes"=>
     ["MSImmutablePage",
      "_MSImmutablePage",
      "MSImmutableLayerGroup",
      "_MSImmutableLayerGroup",
      "MSImmutableStyledLayer",
      "_MSImmutableStyledLayer",
      "MSImmutableLayer",
      "_MSImmutableLayer",
      "MSImmutableModelBase",
      "MSModelObject",
      "NSObject"]},
   {"$classname"=>"MSImmutableDocumentData",
    "$classes"=>
     ["MSImmutableDocumentData",
      "_MSImmutableDocumentData",
      "MSImmutableModelBase",
      "MSModelObject",
      "NSObject"]}],
 "$archiver"=>"MSArchiver",
 "$top"=>{"root"=>1}}
```
